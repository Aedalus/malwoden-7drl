(this["webpackJsonpmalwoden-test"]=this["webpackJsonpmalwoden-test"]||[]).push([[0],{18:function(t,e,a){"use strict";a.r(e);var n,r,i,o,s,c=a(5),l=a.n(c),u=a(10),h=a.n(u),d=a(0),p=a(4),y=a(11),f=a(12),v=a(2),m=a(3),g=a(1);!function(t){t[t.none=0]="none",t[t.tree=1]="tree",t[t.mountain=2]="mountain",t[t.graveyard=3]="graveyard",t[t.hedge=4]="hedge"}(s||(s={}));var w,b=(n={},Object(g.a)(n,s.none,!1),Object(g.a)(n,s.tree,!0),Object(g.a)(n,s.mountain,!0),Object(g.a)(n,s.graveyard,!0),Object(g.a)(n,s.hedge,!0),n),x=(r={},Object(g.a)(r,s.none,d.f.fromCharCode(d.a.blackSquare,d.b.Black,d.b.Black)),Object(g.a)(r,s.tree,d.f.fromCharCode(d.a.blackSpadeSuit,d.b.Green)),Object(g.a)(r,s.mountain,d.f.fromCharCode(d.a.blackUpPointingTriangle,d.b.Brown)),Object(g.a)(r,s.graveyard,d.f.fromCharCode(d.a.upDownArrowWithBase)),Object(g.a)(r,s.hedge,d.f.fromCharCode(d.a.greekSmallLetterPi)),r),A=(i={},Object(g.a)(i,s.none,d.f.fromCharCode(d.a.blackSquare,d.b.Black.blendPercent(d.b.DimGray,50),d.b.Black.blendPercent(d.b.DimGray,50))),Object(g.a)(i,s.tree,d.f.fromCharCode(d.a.blackSpadeSuit,d.b.Black.blendPercent(d.b.DimGray,20),d.b.Black.blendPercent(d.b.DimGray,50))),Object(g.a)(i,s.mountain,d.f.fromCharCode(d.a.blackUpPointingTriangle,d.b.DarkGray)),Object(g.a)(i,s.graveyard,d.f.fromCharCode(d.a.upDownArrowWithBase)),Object(g.a)(i,s.hedge,d.f.fromCharCode(d.a.greekSmallLetterPi)),i),C=(o={},Object(g.a)(o,s.none,!1),Object(g.a)(o,s.tree,!0),Object(g.a)(o,s.mountain,!0),Object(g.a)(o,s.graveyard,!0),Object(g.a)(o,s.hedge,!0),o);!function(t){t.LOW="low",t.MID="mid",t.HIGH="high",t.WARNING="warning"}(w||(w={}));var S,E,k=new(function(){function t(){Object(v.a)(this,t),this.maxLogs=7,this.entries=[],this.lastEntry="",this.lastEntryCount=1}return Object(m.a)(t,[{key:"addEntryLow",value:function(t){this.addEntry(w.LOW,t)}},{key:"addEntryMid",value:function(t){this.addEntry(w.MID,t)}},{key:"addEntryHigh",value:function(t){this.addEntry(w.HIGH,t)}},{key:"addEntryWarning",value:function(t){this.addEntry(w.WARNING,t)}},{key:"addEntry",value:function(t,e){for(e===this.lastEntry?(this.lastEntryCount++,this.entries.pop(),this.entries.push([t,"".concat(e," (x").concat(this.lastEntryCount,")")])):(this.entries.push([t,e]),this.lastEntryCount=1),this.lastEntry=e;this.entries.length>this.maxLogs;)this.entries.shift()}},{key:"length",value:function(){return this.entries.length}}]),t}()),P=function(){function t(e,a,n,r){Object(v.a)(this,t),this.name=void 0,this.startPos=void 0,this.entites=void 0,this.map=void 0,this.fow=void 0,this.fowVisited=void 0,this.name=e,this.map=a,this.entites=n,this.startPos=r,this.fow=!0,this.fowVisited=new d.k.Table(this.map.width,this.map.height)}return Object(m.a)(t,[{key:"addEntity",value:function(t){this.entites.push(t)}},{key:"removeEntity",value:function(t){this.entites=this.entites.filter((function(e){return e.id!==t.id}))}}]),t}(),O=new d.i.AleaRNG;function G(t){return{id:Math.random().toString(),name:"Scorpion",enemy:!0,position:t.position,renderPriority:2,glyph:d.f.fromCharCode(d.a.poundSign,d.b.AliceBlue),ai:"chase",collision:!0,vision:6,stats:{hp:20,maxHp:20,level:1,attack:7,armor:5,exp:50}}}function M(t){return{id:Math.random().toString(),name:"Ants",enemy:!0,position:t.position,renderPriority:2,glyph:d.f.fromCharCode(d.a.caret,d.b.AliceBlue),ai:"wander",collision:!0,vision:6,stats:{hp:6,maxHp:6,level:1,attack:4,armor:3,exp:50}}}function T(t){return{id:Math.random().toString(),name:"Ladybug",enemy:!0,position:t.position,renderPriority:2,glyph:d.f.fromCharCode(d.a.lUpper,d.b.Red),ai:"wander",collision:!0,stats:{hp:1,maxHp:1,level:1,attack:2,armor:2,exp:10}}}function I(t){return{id:Math.random().toString(),name:"Mal",player:!0,position:t.position,incomingDamage:[],renderPriority:1,glyph:d.f.fromCharCode(d.a.at,d.b.Yellow),vision:7,collision:!0,stats:{hp:15,maxHp:15,level:1,attack:3,armor:1,exp:0}}}function j(t){return{id:Math.random().toString(),name:"Stairs",position:t.position,renderPriority:3,glyph:d.f.fromCharCode(d.a.downwardsArrow,d.b.Cyan),stairs:!0}}function N(t){var e=O.nextItem([1,1,1,2]),a=1===e?d.b.Purple:d.b.MediumPurple;return{id:Math.random().toString(),name:"Berry",position:t.position,renderPriority:4,glyph:d.f.fromCharCode(d.a.bullet,a),consumable:{hp:e}}}function D(t){var e=O.nextItem([20,20,20,30,30,50]);return{id:Math.random().toString(),name:"Snail Book",position:t.position,renderPriority:4,glyph:d.f.fromCharCode(d.a.equals,d.b.Brown),consumable:{exp:e}}}function R(t,e){for(var a=0;a<t.width;a++)for(var n=0;n<t.height;n++)0!==a&&a!==t.width-1&&0!==n&&n!==t.height-1||t.set({x:a,y:n},e)}function H(t,e,a,n){var r=t,i=e,o=new d.e.CellularAutomata(r,i,{aliveValue:s.tree,deadValue:s.none});o.randomize(.63),o.doSimulationStep(3),o.connect(),R(o.table,s.tree);for(var c=[],l=0;l<o.table.width;l++)for(var u=0;u<o.table.height;u++)0===o.table.get({x:l,y:u})&&c.push({x:l,y:u});var h,p=new d.i.AleaRNG,y=p.shuffle(c),f=[],v=0,m=y[v++];a&&f.push(I({position:m})),f.push(j({position:y[v++]}));for(var g=0;g<n.enemies;g++){var w=p.nextBoolean()?(h={position:y[v++]},{id:Math.random().toString(),name:"Mantis",enemy:!0,position:h.position,renderPriority:2,glyph:d.f.fromCharCode(d.a.mUpper,d.b.Orange),ai:"chase",collision:!0,vision:6,stats:{hp:3,maxHp:3,level:1,attack:3,armor:2,exp:20}}):T({position:y[v++]});f.push(w)}for(var b=0;b<n.berries;b++){var x=N({position:y[v++]});f.push(x)}for(var A=0;A<n.books;A++){var C=D({position:y[v++]});f.push(C)}return f.push(function(t){return{id:Math.random().toString(),name:"The Mystic Shell!",position:t.position,renderPriority:4,glyph:d.f.fromCharCode(d.a.at,d.b.MediumPurple),consumable:{winCondition:!0}}}({position:y[v++]})),new P(n.name,o.table,f,m)}function W(t,e,a,n){var r=t,i=e,o=new d.e.DrunkardsWalk({width:r,height:i,topology:"four"});o.walkSteps({steps:1/0,maxCoveredTiles:1e3});for(var c=0;c<o.table.width;c++)for(var l=0;l<o.table.height;l++){var u=o.table.get({x:c,y:l});o.table.set({x:c,y:l},u?s.none:s.mountain)}R(o.table,s.mountain);for(var h=[],p=0;p<o.table.width;p++)for(var y=0;y<o.table.height;y++)0===o.table.get({x:p,y:y})&&h.push({x:p,y:y});var f,v=new d.i.AleaRNG,m=v.shuffle(h),g=[],w=0,b=m[w++];a&&g.push(I({position:b})),g.push(j({position:m[w++]}));for(var x=0;x<n.enemies;x++){var A=v.nextItem([M({position:m[w++]}),M({position:m[w++]}),(f={position:m[w++]},{id:Math.random().toString(),name:"Snake",enemy:!0,position:f.position,renderPriority:2,glyph:d.f.fromCharCode(d.a.sUpper,d.b.Green),ai:"chase",collision:!0,vision:6,stats:{hp:5,maxHp:5,level:1,attack:5,armor:3,exp:70}})]);g.push(A)}for(var C=0;C<n.scorpions;C++)g.push(G({position:m[w++]}));for(var S=0;S<n.berries;S++){var E=N({position:m[w++]});g.push(E)}for(var k=0;k<n.books;k++){var O=D({position:m[w++]});g.push(O)}return new P(n.name,o.table,g,b)}function L(t){switch(t){case 1:return H(52,38,!0,{name:"The Short Grass",enemies:7,books:1,berries:4});case 2:return H(52,38,!1,{name:"The Tall Grass",enemies:10,books:1,berries:4});case 3:return W(52,38,!1,{name:"The Gravel Path",enemies:10,scorpions:0,berries:5,books:1});case 4:return W(52,38,!1,{name:"The Scorpion Den",enemies:15,scorpions:2,berries:5,books:3})}throw new Error("Stage ID not recognized!")}!function(t){t[t.GAME_START=0]="GAME_START",t[t.PLAYER_TURN=1]="PLAYER_TURN",t[t.ENEMY_TURN=2]="ENEMY_TURN",t[t.AWAITING_INPUT=3]="AWAITING_INPUT",t[t.GAME_WIN=4]="GAME_WIN",t[t.GAME_LOSS=5]="GAME_LOSS"}(S||(S={})),function(t){t.UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right"}(E||(E={}));new d.i.AleaRNG;var _={stageCount:1,stage:L(1),posCache:new Map,playerCache:void 0,help:!0,currentGameState:S.GAME_START};function U(){k.addEntryHigh("You are reborn. Let the snailing continue!"),_.stageCount=1;var t=L(_.stageCount);_.stage=t,_.currentGameState=S.GAME_START}function B(t){return t*(t+1)/2*100}var Y=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"loop",value:function(t){var e=t.entites.find((function(t){return t.player}));if(e&&e.stats){var a=e.stats.level,n=e.stats.exp;if(B(a)<=n){k.addEntryHigh("You have leveled up!");var r=Math.round(Math.random());e.stats.hp=e.stats.hp+2+r,e.stats.maxHp=e.stats.maxHp+2+r,e.stats.attack=e.stats.attack+1,e.stats.armor=e.stats.armor+1,e.stats.level=e.stats.level+1}}}}]),t}(),F={high:d.b.Cyan,mid:d.b.White,low:d.b.Gray,warning:d.b.Red},X=function(){function t(){Object(v.a)(this,t),this.mouse=new d.g.MouseHandler}return Object(m.a)(t,[{key:"loop",value:function(t){var e,a,n=t.terminal,r=t.mapTerminal;n.clear();var i=_.stage.entites.find((function(t){return t.player})),o=(null===i||void 0===i||null===(e=i.viewShed)||void 0===e?void 0:e.area)||new Map;if(d.d.box(n,{title:"Player",origin:{x:0,y:0},width:15,height:20}),i&&i.stats){n.writeAt({x:2,y:2},"HP: ".concat(i.stats.hp,"/").concat(i.stats.maxHp)),V(n,{x:2,y:3},10,i.stats.hp/i.stats.maxHp,d.b.Red);var s=B(i.stats.level),c=B(i.stats.level-1);n.writeAt({x:2,y:5},"EXP"),V(n,{x:2,y:6},10,(i.stats.exp-c)/s,d.b.Gold),n.writeAt({x:2,y:9},"Level:  ".concat(i.stats.level)),n.writeAt({x:2,y:10},"Attack: ".concat(i.stats.attack)),n.writeAt({x:2,y:11},"Armor:  ".concat(i.stats.armor))}n.writeAt({x:2,y:18},"(h) help"),d.d.box(n,{title:"Log",origin:{x:16,y:40},width:53,height:9});for(var l=0;l<k.length();l++){var u=Object(f.a)(k.entries[l],2),h=u[0],v=u[1],m=F[h];n.writeAt({x:17,y:41+l},v,m)}d.d.box(n,{origin:{x:16,y:0},width:53,height:39}),n.writeAt({x:17,y:0}," Stage ".concat(_.stageCount," | ").concat(_.stage.name," "));for(var g=0;g<_.stage.map.width;g++)for(var w=0;w<_.stage.map.height;w++){var b={x:g,y:w},C=_.stage.map.get({x:g,y:w});if(_.stage.fowVisited.isInBounds(b)&&_.stage.fowVisited.get(b)){if(void 0!==C){var E=A[C];E&&r.drawGlyph({x:g,y:w},E)}}else r.drawCharCode(b,d.a.blackSquare,d.b.DimGray.blendPercent(d.b.Black,70),d.b.DimGray.blendPercent(d.b.Black,70))}var P=[];o.forEach((function(t){var e=_.stage.map.get(t),a=_.posCache.get("".concat(t.x,":").concat(t.y))||[];if(P.push.apply(P,Object(y.a)(a)),void 0!==e){var n=x[e];n&&r.drawGlyph(t,n)}if(null===a||void 0===a?void 0:a.length){var i,o=a.sort((function(t,e){return e.renderPriority-t.renderPriority})),s=Object(p.a)(o);try{for(s.s();!(i=s.n()).done;){var c=i.value;r.drawGlyph(c.position,c.glyph)}}catch(l){s.e(l)}finally{s.f()}}})),d.d.box(n,{title:"Info",origin:{x:0,y:21},width:15,height:28});for(var O=P.filter((function(t){return t.enemy&&t.stats})).sort((function(t,e){return t.id.localeCompare(e.id)})),G=0;G<Math.min(O.length,5);G++){var M=O[G],T=23+3*G;n.writeAt({x:2,y:T},M.name),V(n,{x:2,y:T+1},10,M.stats.hp/M.stats.maxHp,M.glyph.fore)}var I=this.mouse.getPos(),j=n.pixelToChar(I),N={x:j.x-17,y:j.y-1};if(null===i||void 0===i||null===(a=i.viewShed)||void 0===a?void 0:a.area.has("".concat(N.x,":").concat(N.y))){var D=_.posCache.get("".concat(N.x,":").concat(N.y));(null===D||void 0===D?void 0:D.length)&&function(t,e,a){if(e.x<50){var n={x:e.x+3,y:e.y};t.drawCharCode({x:e.x+1,y:e.y},d.a.leftwardsArrow,d.b.DarkSlateGray,d.b.White),t.drawCharCode({x:e.x+2,y:e.y},d.a.blackSquare,d.b.White,d.b.DarkSlateGray),t.writeAt(n,a,d.b.White,d.b.DarkSlateGray)}else{t.drawCharCode({x:e.x-1,y:e.y},d.a.rightwardsArrow,d.b.DarkSlateGray,d.b.White),t.drawCharCode({x:e.x-2,y:e.y},d.a.blackSquare,d.b.White,d.b.DarkSlateGray);var r={x:e.x-2-a.length,y:e.y};t.writeAt(r,a,d.b.White,d.b.DarkSlateGray)}}(n,j,D[0].name)}_.currentGameState===S.GAME_WIN&&function(t){t.clear();var e=12,a=15;t.writeAt({x:e,y:a},"Mal",d.b.Yellow),t.writeAt({x:e+4,y:a},"found the"),t.writeAt({x:e+14,y:a},"Mystic Shell!",d.b.MediumPurple);var n=12,r=10;K.faceRight?(t.writeAt({x:n+K.dX,y:r},"@",d.b.MediumPurple),t.writeAt({x:n+1+K.dX,y:r},"_,",d.b.Yellow)):(t.writeAt({x:n-3+K.dX,y:r},",_",d.b.Yellow),t.writeAt({x:n-1+K.dX,y:r},"@",d.b.MediumPurple));t.writeAt({x:5,y:20},"With the shell's wisdom, the snail kingdom"),t.writeAt({x:7,y:22},"would propser under a new golden age."),t.writeAt({x:12,y:26},"Not the fastest golden age,"),t.writeAt({x:15,y:28},"but good nonetheless.");var i=25,o=35;t.writeAt({x:i,y:o},"Press (esc) to "),t.writeAt({x:i+15,y:o},"@_,",d.b.Yellow),t.writeAt({x:i+19,y:o},"again!")}(r),_.currentGameState===S.GAME_LOSS&&function(t){t.clear();var e=20,a=15;t.writeAt({x:e,y:a},"Mal",d.b.Yellow),t.writeAt({x:e+4,y:a},"has"),t.writeAt({x:e+8,y:a},"Died!",d.b.Red);var n=24,r=10;t.writeAt({x:n+K.dX,y:r},"@_,",d.b.Red);var i=25,o=35;t.writeAt({x:i,y:o},"Press (esc) to "),t.writeAt({x:i+15,y:o},"@_,",d.b.Yellow),t.writeAt({x:i+19,y:o},"again!")}(r),_.help&&function(t){d.d.box(t,{origin:{x:2,y:2},width:65,height:45,title:"Help"});var e=5,a=6;t.writeAt({x:e,y:a},"Help"),t.writeAt({x:e+5,y:a},"Mal the Snail",d.b.Yellow),t.writeAt({x:e+19,y:a},"travel through the garden,"),t.writeAt({x:e,y:a+2},"and retrieve the "),t.writeAt({x:e+17,y:a+2},"Mystic Shell",d.b.MediumPurple),t.writeAt({x:e+29,y:a+2},".");var n=5,r=12;t.writeAt({x:n,y:r},"-- Controls --",d.b.Cyan),t.writeAt({x:n,y:r+2},"- Use \u2191 \u2193 \u2190 \u2192 to move."),t.writeAt({x:n,y:r+4},"- Use (Space) to skip a turn."),t.writeAt({x:n,y:r+6},"- Move into an enemy to attack them."),t.writeAt({x:n,y:r+8},"- Hover over objects to see a description.");var i=47,o=45;t.writeAt({x:i,y:o},"Press (esc) to "),t.writeAt({x:i+15,y:o},"@_,",d.b.Yellow)}(n),n.render()}}]),t}();function V(t,e,a,n,r){for(var i=Math.ceil(a*n),o=0;o<a;o++){var s=o<=i?r:r.blend(d.b.Black);t.drawCharCode({x:e.x+o,y:e.y},d.a.blackSquare,s,s)}}var q,K={faceRight:!0,dX:0};setInterval((function(){if(_.currentGameState!==S.GAME_WIN)return K.faceRight=!0,void(K.dX=0);K.faceRight?K.dX<25?K.dX++:K.faceRight=!1:K.dX>0?K.dX--:K.faceRight=!0}),150),function(t){t[t.NONE=0]="NONE",t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t[t.SPACE=5]="SPACE",t[t.ESC=6]="ESC",t[t.HELP=7]="HELP"}(q||(q={}));var z,J=function(){function t(){var e=this;Object(v.a)(this,t),this.currentPlayerInput=q.NONE;var a=new d.g.KeyboardHandler,n=(new d.g.KeyboardContext).onDown(d.g.KeyCode.DownArrow,(function(){return e.currentPlayerInput=q.DOWN})).onDown(d.g.KeyCode.LeftArrow,(function(){return e.currentPlayerInput=q.LEFT})).onDown(d.g.KeyCode.RightArrow,(function(){return e.currentPlayerInput=q.RIGHT})).onDown(d.g.KeyCode.UpArrow,(function(){return e.currentPlayerInput=q.UP})).onDown(d.g.KeyCode.Space,(function(){return e.currentPlayerInput=q.SPACE})).onDown(d.g.KeyCode.Escape,(function(){return e.currentPlayerInput=q.ESC})).onDown(d.g.KeyCode.H,(function(){return e.currentPlayerInput=q.HELP}));a.setContext(n)}return Object(m.a)(t,[{key:"loop",value:function(t){if(this.currentPlayerInput===q.NONE)return!1;var e=t.entites.find((function(t){return t.player})),a=!1;return this.currentPlayerInput===q.HELP&&(_.help=!0,a=!1),this.currentPlayerInput===q.ESC?(_.help&&(_.help=!1),_.currentGameState!==S.GAME_WIN&&_.currentGameState!==S.GAME_LOSS||U(),a=!1):this.currentPlayerInput===q.SPACE?a=!0:this.currentPlayerInput===q.UP?(e.wantsToMove=E.UP,a=!0):this.currentPlayerInput===q.DOWN?(e.wantsToMove=E.DOWN,a=!0):this.currentPlayerInput===q.RIGHT?(e.wantsToMove=E.RIGHT,a=!0):this.currentPlayerInput===q.LEFT&&(e.wantsToMove=E.LEFT,a=!0),this.currentPlayerInput=q.NONE,a}}]),t}();var Q,Z,$=(z={},Object(g.a)(z,E.UP,{x:0,y:-1}),Object(g.a)(z,E.DOWN,{x:0,y:1}),Object(g.a)(z,E.LEFT,{x:-1,y:0}),Object(g.a)(z,E.RIGHT,{x:1,y:0}),z),tt=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"loop",value:function(t){var e,a=Object(p.a)(t.entites);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(n.wantsToMove){var r=$[n.wantsToMove];n.wantsToMove=void 0;var i={x:n.position.x+r.x,y:n.position.y+r.y},o=_.posCache.get("".concat(i.x,":").concat(i.y))||[];if(o.some((function(t){return t.collision}))){this.checkCombat(n,o);continue}var s=t.map.get(i);if(!!s&&b[s])continue;n.position.x+=r.x,n.position.y+=r.y,n.vision&&n.viewShed&&(n.viewShed.dirty=!0)}}}catch(c){a.e(c)}finally{a.f()}}},{key:"checkCombat",value:function(t,e){var a=e.find((function(e){return e.enemy!==t.enemy&&e.stats}));a&&a.stats&&function(t,e){var a,n;a=function(t){var e,a=0;return t.stats&&(a+=null===(e=t.stats)||void 0===e?void 0:e.armor),a}(e),n=function(t){var e=0;return t.stats&&(e=t.stats.attack),e}(t)-a,function(t,e,a){var n;a.incomingDamage||(a.incomingDamage=[]),null===(n=a.incomingDamage)||void 0===n||n.push({source:t,damage:e})}(t.name,n,e)}(t,a)}}]),t}(),et=function(){function t(){Object(v.a)(this,t),this.rng=new d.i.AleaRNG}return Object(m.a)(t,[{key:"getRandDirection",value:function(){return this.rng.nextItem([E.UP,E.DOWN,E.LEFT,E.RIGHT,void 0])}},{key:"loop",value:function(t){var e,a=Object(p.a)(t.entites);try{for(a.s();!(e=a.n()).done;){var n=e.value;"chase"===n.ai?this.chaseAI(n):"wander"===n.ai&&this.wanderAI(n)}}catch(r){a.e(r)}finally{a.f()}}},{key:"chaseAI",value:function(t){if(!t.viewShed)throw new Error("".concat(t.name," does not have a viewshed!"));var e=_.playerCache.position;if(t.viewShed.area.has("".concat(e.x,":").concat(e.y))){var a=new d.h.AStar({topology:"four",isBlockedCallback:function(t){if(t.x===e.x&&t.y===e.y)return!1;var a=_.stage.map.get(t);return!(!a||!b[a])}}).compute(t.position,e);if(a&&a.length>=2){var n=this.getDirectionFromVectors(a[0],a[1]);n?t.wantsToMove=n:console.warn("No direction found for",a[0],a[1])}}else this.wanderAI(t)}},{key:"getDirectionFromVectors",value:function(t,e){var a=e.x-t.x,n=e.y-t.y;return 1===a&&0===n?E.RIGHT:-1===a&&0===n?E.LEFT:0===a&&1===n?E.DOWN:0===a&&-1===n?E.UP:void 0}},{key:"wanderAI",value:function(t){var e=this.getRandDirection();e&&(t.wantsToMove=e)}}]),t}(),at=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"loop",value:function(t){var e,a=t.entites.find((function(t){return t.player})),n=t.entites.filter((function(t){return t.stairs})),r=Object(p.a)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.position.x===(null===a||void 0===a?void 0:a.position.x)&&i.position.y===a.position.y)if(i.restart)U();else{k.addEntryMid("Descending the stairs"),_.stageCount++;var o=L(_.stageCount);o.addEntity(a),_.stage=o,a.position.x=o.startPos.x,a.position.y=o.startPos.y}}}catch(s){r.e(s)}finally{r.f()}}}]),t}(),nt=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"loop",value:function(){_.posCache.clear();var t,e=Object(p.a)(_.stage.entites);try{for(e.s();!(t=e.n()).done;){var a,n=t.value,r="".concat(n.position.x,":").concat(n.position.y);if(_.posCache.has(r))null===(a=_.posCache.get(r))||void 0===a||a.push(n);else _.posCache.set(r,[n]);n.player&&(_.playerCache=n)}}catch(i){e.e(i)}finally{e.f()}}}]),t}(),rt=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"makeCorpse",value:function(t){var e,a;("Mal"===t.name&&(k.addEntryWarning("You have died."),_.currentGameState=S.GAME_LOSS),k.addEntryMid(t.name+" has died horribly."),_.playerCache&&_.playerCache.stats&&t.stats)&&(_.playerCache.stats.exp=(null===(e=_.playerCache.stats)||void 0===e?void 0:e.exp)+(null===(a=t.stats)||void 0===a?void 0:a.exp));return t.renderPriority=3,t.enemy=!1,t.collision=!1,t.stats=void 0,t.ai=void 0,t.name+=" (corpse)",t.glyph=new d.f("x",d.b.White),t}},{key:"checkAlive",value:function(t){if(t.stats)return t.stats.hp>0||(this.makeCorpse(t),!1)}},{key:"applyDamage",value:function(t,e){if(!t||!t.stats)throw new Error("Cannot damage ".concat(t.name," as it has no stats"));t.stats.hp=t.stats.hp-e.damage}},{key:"loop",value:function(t){var e,a=Object(p.a)(t.entites);try{for(a.s();!(e=a.n()).done;)for(var n=e.value;n.incomingDamage&&n.incomingDamage.length>0;){var r=n.incomingDamage.pop();this.applyDamage(n,r),k.addEntryLow(n.name+" was hit for "+r.damage+" by "+r.source),this.checkAlive(n)}}catch(i){a.e(i)}finally{a.f()}}}]),t}(),it=function(){function t(){Object(v.a)(this,t),this.fov=new d.c.PreciseShadowcasting({topology:"eight",cartesianRange:!0,lightPasses:function(t){var e=_.stage.map.get(t);return!e||!1===C[e]}})}return Object(m.a)(t,[{key:"loop",value:function(t){var e,a=Object(p.a)(t.entites);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(n.vision&&((!n.viewShed||!1!==n.viewShed.dirty)&&n.vision&&(!n.viewShed||n.viewShed.dirty))){var r,i=this.fov.calculateArray(n.position,n.vision),o=new Map,s=Object(p.a)(i);try{for(s.s();!(r=s.n()).done;){var c=r.value;o.set("".concat(c.pos.x,":").concat(c.pos.y),c.pos)}}catch(d){s.e(d)}finally{s.f()}if(n.viewShed={area:o,dirty:!1},n.player){var l,u=Object(p.a)(i);try{for(u.s();!(l=u.n()).done;){var h=l.value;t.fowVisited.isInBounds(h.pos)&&t.fowVisited.set(h.pos,!0)}}catch(d){u.e(d)}finally{u.f()}}}}}catch(d){a.e(d)}finally{a.f()}}}]),t}(),ot=function(){function t(){Object(v.a)(this,t)}return Object(m.a)(t,[{key:"loop",value:function(t){var e,a=_.playerCache,n=_.posCache.get("".concat(a.position.x,":").concat(a.position.y))||[],r=Object(p.a)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.consumable&&i.position.x===a.position.x&&i.position.y===a.position.y){var o=!1;i.consumable.hp&&a.stats.hp<a.stats.maxHp&&(a.stats.hp=Math.min(a.stats.maxHp,a.stats.hp+i.consumable.hp),k.addEntryMid("You ate a ".concat(i.name," and regained ").concat(i.consumable.hp," hp!")),o=!0),i.consumable.exp&&(k.addEntryMid("You read a ".concat(i.name," and gained ").concat(i.consumable.exp," exp!")),a.stats.exp+=i.consumable.exp,o=!0),i.consumable.winCondition&&(_.currentGameState=S.GAME_WIN,o=!0),o&&_.stage.removeEntity(i)}}}catch(s){r.e(s)}finally{r.f()}}}]),t}(),st=new X,ct=new J,lt=new tt,ut=new et,ht=new at,dt=new nt,pt=new it,yt=new rt,ft=new Y,vt=new ot;var mt=a(8);var gt=function(){var t=l.a.useRef(NaN);return Object(c.useEffect)((function(){var e=document.getElementById("malwoden"),a=new d.j.RetroTerminal({width:70,height:50,imageURL:"./font_16.png",charWidth:16,charHeight:16,mountNode:e});Z=(Q=a).port({x:17,y:1},52,38),k.addEntryHigh("Game Start!"),st.loop({stage:_.stage,mapTerminal:Z,terminal:Q});return t.current=window.requestAnimationFrame((function e(){!function(){if(dt.loop(),_.currentGameState===S.GAME_WIN||_.currentGameState===S.GAME_LOSS)return ct.loop(_.stage),void st.loop({stage:_.stage,mapTerminal:Z,terminal:Q});_.currentGameState===S.AWAITING_INPUT&&ct.loop(_.stage)&&(_.currentGameState=S.PLAYER_TURN),lt.loop(_.stage),vt.loop(_.stage),ht.loop(_.stage),pt.loop(_.stage),yt.loop(_.stage),ft.loop(_.stage),_.currentGameState===S.ENEMY_TURN&&ut.loop(_.stage),_.currentGameState===S.GAME_START?_.currentGameState=S.AWAITING_INPUT:_.currentGameState===S.PLAYER_TURN?_.currentGameState=S.ENEMY_TURN:_.currentGameState===S.ENEMY_TURN&&(_.currentGameState=S.AWAITING_INPUT),st.loop({stage:_.stage,mapTerminal:Z,terminal:Q})}(),t.current=window.requestAnimationFrame(e)})),function(){return window.cancelAnimationFrame(t.current)}}),[]),Object(mt.jsx)("div",{id:"malwoden",style:{display:"flex",justifyContent:"center",paddingTop:"50px"}})},wt=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,19)).then((function(e){var a=e.getCLS,n=e.getFID,r=e.getFCP,i=e.getLCP,o=e.getTTFB;a(t),n(t),r(t),i(t),o(t)}))};h.a.render(Object(mt.jsx)(l.a.StrictMode,{children:Object(mt.jsx)(gt,{})}),document.getElementById("root")),wt()}},[[18,1,2]]]);
//# sourceMappingURL=main.20112274.chunk.js.map